<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head th:replace="~{fragments/config :: defaultHead('ë²„ê·¸ë²„ê·¸', ~{::link})}"></head>
<body>
<div th:replace="~{fragments/header :: header}"></div>

<div class="container mt-xl">
  <!-- ê²Œì„ ì§„í–‰ ìƒí™© í‘œì‹œ -->
  <div class="card mb-xl">
    <div class="card-header">
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <h3 class="text-brand font-semibold">ì§„í–‰ ìƒí™©</h3>
        <div class="score-display">
          ì ìˆ˜: <span id="score" class="text-primary font-bold">0</span> / <span id="totalScore" class="text-secondary">0</span>
        </div>
      </div>
      <div class="progress-container mt-md">
        <div id="progressBar" class="progress-bar"></div>
      </div>
    </div>
  </div>

  <!-- ë©”ì¸ ì¼€ì´ìŠ¤ -->
  <div class="card mb-xl" id="case-intro">
    <div class="card-header">
      <h1 class="text-primary" th:text="${bug.title}">ì‚¬ë¡€ #1: ì‚¬ë¼ì§„ íšŒì› ë°ì´í„°</h1>
    </div>

    <div class="card-body">
      <!-- ì‹œë‚˜ë¦¬ì˜¤ ì„¹ì…˜ -->
      <div class="scenario mb-xl">
        <h2 class="text-primary-700 mb-lg">ì‹œë‚˜ë¦¬ì˜¤</h2>
        <p class="mb-md">
          ë‹¹ì‹ ì€ ëŒ€í˜• e-ì»¤ë¨¸ìŠ¤ íšŒì‚¬ì˜ ë°±ì—”ë“œ ê°œë°œìì…ë‹ˆë‹¤. íšŒì› ê°€ì… ì§í›„ í•´ë‹¹ íšŒì›ì˜ ì •ë³´ë¥¼ ì¡°íšŒí•˜ëŠ” APIì—ì„œ ê°„í—ì ìœ¼ë¡œ ë¬¸ì œê°€ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤.
          íšŒì› ê°€ì…ì€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì§€ë§Œ, ë°”ë¡œ ì´ì–´ì„œ íšŒì› ì •ë³´ë¥¼ ì¡°íšŒí•˜ë©´ ê°€ë” ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ë‹¤ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤.
          í•˜ì§€ë§Œ ê°™ì€ APIë¥¼ ë‹¤ì‹œ í˜¸ì¶œí•˜ë©´ ì •ìƒì ìœ¼ë¡œ ì¡°íšŒë©ë‹ˆë‹¤.
        </p>
        <p class="mb-0">
          ì´ ë¬¸ì œëŠ” íŠ¹íˆ íŠ¸ë˜í”½ì´ ë§ì€ ì‹œê°„ëŒ€ì— ë” ìì£¼ ë°œìƒí•˜ê³  ìˆìœ¼ë©°, ìš´ì˜íŒ€ìœ¼ë¡œë¶€í„° ê¸´ê¸‰í•˜ê²Œ í•´ê²°ì„ ìš”ì²­ë°›ì•˜ìŠµë‹ˆë‹¤.
        </p>
      </div>

      <!-- ë‹¨ì„œ ë²„íŠ¼ë“¤ -->
      <div class="mb-xl">
        <h3 class="text-primary mb-lg">ğŸ” ë‹¨ì„œ ì¡°ì‚¬</h3>
        <div style="display: flex; gap: var(--space-md); flex-wrap: wrap;">
          <button class="btn btn-primary" onclick="showClue('application-config')">
            ğŸ“‹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •
          </button>
          <button class="btn btn-primary" onclick="showClue('database-config')">
            ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
          </button>
          <button class="btn btn-primary" onclick="showClue('code-structure')">
            ğŸ’» ì½”ë“œ êµ¬ì¡°
          </button>
          <button class="btn btn-primary" onclick="showClue('error-logs')">
            âš ï¸ ì—ëŸ¬ ë¡œê·¸
          </button>
          <button class="btn btn-primary" onclick="showClue('db-logs')">
            ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ë¡œê·¸
          </button>
        </div>
      </div>

      <!-- ë‹¨ì„œë“¤ -->
      <div id="application-config" class="clue hidden fade-in">
        <h3>ğŸ“‹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •</h3>
        <div class="code-block has-filename">
          <div class="code-filename">application.yml</div>
          <pre>spring:
  datasource:
    url: jdbc:mysql://db-master.example.com:3306/userdb?useSSL=false
    username: app_user
    password: [REDACTED]
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      auto-commit: false  # ìë™ ì»¤ë°‹ ì„¤ì • ë¹„í™œì„±í™”
      maximum-pool-size: 10
      minimum-idle: 5
  jpa:
    hibernate:
      ddl-auto: none
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL57Dialect
        show_sql: true
        format_sql: true
    open-in-view: true  # Open Session In View íŒ¨í„´ í™œì„±í™”</pre>
        </div>
      </div>

      <div id="database-config" class="clue hidden fade-in">
        <h3>ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •</h3>
        <div class="code-block">
                        <pre>MySQL ë²„ì „: 5.7.38-log
íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€: REPEATABLE READ (ê¸°ë³¸ê°’)
ì½ê¸°/ì“°ê¸° ë¶„ë¦¬: ì ìš©ë¨ (Master-Slave êµ¬ì¡°)
Connection Pool: HikariCP</pre>
        </div>
        <div class="mt-md p-md" style="background-color: var(--info-50); border-left: 4px solid var(--info-500); border-radius: var(--radius-md);">
          <p class="text-info-700 mb-0">
            <strong>ğŸ’¡ ì°¸ê³ :</strong> Master-Slave êµ¬ì„±ì—ì„œ ì“°ê¸° ì‘ì—…ì€ Masterë¡œ, ì½ê¸° ì‘ì—…ì€ Slaveë¡œ ë¼ìš°íŒ…ë©ë‹ˆë‹¤.
            ë‹¨, @Transactional(readOnly = false) ë˜ëŠ” @Transactional ì„¤ì •ì´ ìˆëŠ” ê²½ìš° ì½ê¸° ì‘ì—…ë„ Masterë¡œ ë¼ìš°íŒ…ë©ë‹ˆë‹¤.
          </p>
        </div>
      </div>

      <div id="code-structure" class="clue hidden fade-in">
        <h3>ğŸ’» ì½”ë“œ êµ¬ì¡°</h3>

        <div class="code-block has-filename mb-lg">
          <div class="code-filename">MemberController.java</div>
          <pre>@RestController
@RequestMapping("/api/members")
public class MemberController {

    private final MemberService memberService;

    @PostMapping
    public ResponseEntity&lt;?&gt; createMember(@RequestBody MemberRequest request) {
        Member member = memberService.createMember(request);
        return ResponseEntity.ok(member);
    }

    @GetMapping("/{id}")
    public ResponseEntity&lt;?&gt; getMember(@PathVariable Long id) {
        Member member = memberService.getMember(id);
        return ResponseEntity.ok(member);
    }
}</pre>
        </div>

        <div class="code-block has-filename mb-lg">
          <div class="code-filename">MemberService.java</div>
          <pre>@Service
@RequiredArgsConstructor
public class MemberService {

    private final MemberRepository memberRepository;
    private final MembershipService membershipService;

    @Transactional
    public Member createMember(MemberRequest request) {
        Member member = Member.builder()
                .name(request.getName())
                .email(request.getEmail())
                .build();

        return memberRepository.save(member);
    }

    // ì£¼ëª©: @Transactional ì–´ë…¸í…Œì´ì…˜ ì—†ìŒ
    public Member getMember(Long id) {
        Member member = memberRepository.findById(id)
                .orElseThrow(() -&gt; new ResourceNotFoundException("Member not found with id: " + id));

        // íšŒì›ì˜ ë©¤ë²„ì‹­ ì •ë³´ ì¡°íšŒ
        membershipService.getMembershipInfo(id);

        return member;
    }
}</pre>
        </div>

        <div class="code-block has-filename">
          <div class="code-filename">MembershipService.java</div>
          <pre>@Service
@RequiredArgsConstructor
public class MembershipService {

    private final MembershipRepository membershipRepository;

    @Transactional(readOnly = true)
    public MembershipInfo getMembershipInfo(Long memberId) {
        return membershipRepository.findByMemberId(memberId)
                .orElse(MembershipInfo.createDefault());
    }
}</pre>
        </div>
      </div>

      <div id="error-logs" class="clue hidden fade-in">
        <h3>âš ï¸ ì—ëŸ¬ ë¡œê·¸</h3>
        <div class="error-message">2024-05-09 14:23:45.123 ERROR 1234 --- [nio-8080-exec-3] c.e.e.exception.GlobalExceptionHandler   : ResourceNotFoundException: Member not found with id: 10045

          2024-05-09 14:23:47.456 INFO  1234 --- [nio-8080-exec-4] c.e.e.controller.MemberController        : Member found with id: 10045

          2024-05-09 14:30:12.789 ERROR 1234 --- [nio-8080-exec-7] c.e.e.exception.GlobalExceptionHandler   : ResourceNotFoundException: Member not found with id: 10046

          2024-05-09 14:30:15.012 INFO  1234 --- [nio-8080-exec-8] c.e.e.controller.MemberController        : Member found with id: 10046</div>
      </div>

      <div id="db-logs" class="clue hidden fade-in">
        <h3>ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ë¡œê·¸</h3>
        <div class="logs-container">2024-05-09 14:23:40.111 [Connection ID: 45678] INSERT INTO members (name, email) VALUES ('í™ê¸¸ë™', 'hong@example.com')
          2024-05-09 14:23:40.222 [Connection ID: 45678] COMMIT

          2024-05-09 14:23:45.000 [Connection ID: 45679] SELECT * FROM members WHERE id = 10045
          2024-05-09 14:23:45.100 [Connection ID: 45679] -- No rows returned

          2024-05-09 14:23:47.300 [Connection ID: 45680] SELECT * FROM members WHERE id = 10045
          2024-05-09 14:23:47.400 [Connection ID: 45680] -- 1 row returned

          2024-05-09 14:30:10.500 [Connection ID: 45681] INSERT INTO members (name, email) VALUES ('ê¹€ì² ìˆ˜', 'kim@example.com')
          2024-05-09 14:30:10.600 [Connection ID: 45681] COMMIT

          2024-05-09 14:30:12.700 [Connection ID: 45682] SELECT * FROM members WHERE id = 10046
          2024-05-09 14:30:12.800 [Connection ID: 45682] -- No rows returned

          2024-05-09 14:30:15.000 [Connection ID: 45683] SELECT * FROM members WHERE id = 10046
          2024-05-09 14:30:15.100 [Connection ID: 45683] -- 1 row returned</div>
      </div>

      <!-- ì§„ë‹¨ ì„¹ì…˜ -->
      <div class="mt-2xl" id="diagnosis-section">
        <h3 class="text-primary mb-lg">ğŸ¯ ë¬¸ì œ ì§„ë‹¨</h3>
        <p class="text-secondary mb-xl">
          ìœ„ì˜ ë‹¨ì„œë“¤ì„ ë¶„ì„í•œ í›„, ê°€ì¥ ê°€ëŠ¥ì„±ì´ ë†’ì€ ë¬¸ì œ ì›ì¸ì„ ì„ íƒí•˜ì„¸ìš”:
        </p>

        <div class="diagnosis-options">
          <div class="diagnosis-option" onclick="selectDiagnosis(this, 1)">
            <strong class="text-lg">1. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í’€ í¬ê¸° ë¶€ì¡±</strong>
            <p class="text-secondary mt-sm mb-0">
              HikariCPì˜ maximum-pool-sizeê°€ 10ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´, íŠ¸ë˜í”½ì´ ë§ì„ ë•Œ ì—°ê²° ë¶€ì¡±ìœ¼ë¡œ ì¿¼ë¦¬ê°€ ì‹¤íŒ¨í•©ë‹ˆë‹¤.
            </p>
          </div>

          <div class="diagnosis-option" onclick="selectDiagnosis(this, 2)">
            <strong class="text-lg">2. Master-Slave ë³µì œ ì§€ì—° (Replication Lag)</strong>
            <p class="text-secondary mt-sm mb-0">
              ë°ì´í„°ê°€ Masterì— ê¸°ë¡ëœ í›„ Slaveë¡œ ë³µì œë˜ê¸° ì „ì— Slaveì—ì„œ ì¡°íšŒí•´ì„œ ë°ì´í„°ë¥¼ ì°¾ì§€ ëª»í•©ë‹ˆë‹¤.
            </p>
          </div>

          <div class="diagnosis-option" onclick="selectDiagnosis(this, 3)">
            <strong class="text-lg">3. íŠ¸ëœì­ì…˜ ìŠ¤ëƒ…ìƒ· ë¬¸ì œ</strong>
            <p class="text-secondary mt-sm mb-0">
              auto-commit: false ì„¤ì •ê³¼ getMember() ë©”ì„œë“œì— @Transactional ì–´ë…¸í…Œì´ì…˜ì´ ì—†ì–´ì„œ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹/ë¡¤ë°±ë˜ì§€ ì•Šê³ , ì´ë¡œ ì¸í•´ ìŠ¤ëƒ…ìƒ·ì´ ê°±ì‹ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
            </p>
          </div>

          <div class="diagnosis-option" onclick="selectDiagnosis(this, 4)">
            <strong class="text-lg">4. JPA ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ìºì‹± ë¬¸ì œ</strong>
            <p class="text-secondary mt-sm mb-0">
              open-in-view: true ì„¤ì •ìœ¼ë¡œ ì¸í•´ ì´ì „ ìš”ì²­ì˜ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ê°€ ìºì‹œëœ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.
            </p>
          </div>

          <div class="diagnosis-option" onclick="selectDiagnosis(this, 5)">
            <strong class="text-lg">5. ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤ ëˆ„ë½</strong>
            <p class="text-secondary mt-sm mb-0">
              members í…Œì´ë¸”ì— id ì»¬ëŸ¼ì˜ ì¸ë±ìŠ¤ê°€ ì—†ì–´ì„œ ê°„í—ì ìœ¼ë¡œ ì¿¼ë¦¬ ì„±ëŠ¥ì´ ì €í•˜ë©ë‹ˆë‹¤.
            </p>
          </div>
        </div>

        <div id="feedback" class="feedback hidden"></div>

        <div class="text-center mt-xl">
          <button id="submit-btn" class="btn btn-secondary btn-lg" onclick="submitDiagnosis()" disabled>
            ğŸ” ì§„ë‹¨ ì œì¶œ
          </button>
        </div>
      </div>

      <!-- í•´ê²°ì±… ì„¹ì…˜ -->
      <div id="solution" class="mt-2xl hidden">
        <div class="card">
          <div class="card-header">
            <h3 class="text-primary">ğŸ› ï¸ í•´ê²° ë°©ë²•</h3>
            <p class="text-secondary mb-0">ì–´ë–»ê²Œ ì´ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆì„ê¹Œìš”? ê°€ì¥ ì ì ˆí•œ í•´ê²°ì±…ì„ ì„ íƒí•˜ì„¸ìš”:</p>
          </div>

          <div class="card-body">
            <div class="diagnosis-options">
              <div class="diagnosis-option" onclick="selectSolution(this, 1)">
                <strong class="text-lg">1. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í’€ í¬ê¸° ì¦ê°€</strong>
                <p class="text-secondary mt-sm mb-0">
                  HikariCPì˜ maximum-pool-sizeë¥¼ 20 ì´ìƒìœ¼ë¡œ ëŠ˜ë¦½ë‹ˆë‹¤.
                </p>
              </div>

              <div class="diagnosis-option" onclick="selectSolution(this, 2)">
                <strong class="text-lg">2. ëª¨ë“  ì½ê¸° ì‘ì—…ì„ Master ë°ì´í„°ë² ì´ìŠ¤ë¡œ ë¼ìš°íŒ…</strong>
                <p class="text-secondary mt-sm mb-0">
                  ëª¨ë“  ì„œë¹„ìŠ¤ ë©”ì„œë“œì— @Transactionalì„ ì¶”ê°€í•˜ì—¬ ì½ê¸° ì‘ì—…ë„ Masterì—ì„œ ìˆ˜í–‰ë˜ë„ë¡ í•©ë‹ˆë‹¤.
                </p>
              </div>

              <div class="diagnosis-option" onclick="selectSolution(this, 3)">
                <strong class="text-lg">3. getMember() ë©”ì„œë“œì— @Transactional(readOnly = true) ì¶”ê°€</strong>
                <p class="text-secondary mt-sm mb-0">
                  ì¡°íšŒ ë©”ì„œë“œì— íŠ¸ëœì­ì…˜ ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•˜ì—¬ ë©”ì„œë“œ ì¢…ë£Œ ì‹œ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ë˜ê³  ìŠ¤ëƒ…ìƒ·ì´ ê°±ì‹ ë˜ë„ë¡ í•©ë‹ˆë‹¤.
                </p>
              </div>

              <div class="diagnosis-option" onclick="selectSolution(this, 4)">
                <strong class="text-lg">4. open-in-view ì„¤ì •ì„ falseë¡œ ë³€ê²½</strong>
                <p class="text-secondary mt-sm mb-0">
                  ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ìƒëª…ì£¼ê¸°ë¥¼ íŠ¸ëœì­ì…˜ ë²”ìœ„ë¡œ ì œí•œí•©ë‹ˆë‹¤.
                </p>
              </div>

              <div class="diagnosis-option" onclick="selectSolution(this, 5)">
                <strong class="text-lg">5. ë°ì´í„°ë² ì´ìŠ¤ì˜ íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€ì„ READ COMMITTEDë¡œ ë³€ê²½</strong>
                <p class="text-secondary mt-sm mb-0">
                  ë” ë‚®ì€ ê²©ë¦¬ ìˆ˜ì¤€ì„ ì‚¬ìš©í•˜ì—¬ ê° SELECT ë¬¸ë§ˆë‹¤ ìƒˆë¡œìš´ ìŠ¤ëƒ…ìƒ·ì„ ì‚¬ìš©í•˜ë„ë¡ í•©ë‹ˆë‹¤.
                </p>
              </div>
            </div>

            <div class="text-center mt-xl">
              <button id="solution-btn" class="btn btn-success btn-lg" onclick="submitSolution()" disabled>
                âœ… í•´ê²°ì±… ì œì¶œ
              </button>
            </div>
          </div>
        </div>
      </div>

      <div id="solution-feedback" class="feedback hidden"></div>

      <!-- ìƒì„¸ ì„¤ëª… ì„¹ì…˜ -->
      <div id="explanation" class="card mt-2xl hidden">
        <div class="card-header">
          <h3 class="text-primary">ğŸ“š ìƒì„¸ ì„¤ëª…</h3>
        </div>

        <div class="card-body">
          <p class="text-lg mb-lg">ì´ ë¬¸ì œëŠ” ë°ì´í„°ë² ì´ìŠ¤ íŠ¸ëœì­ì…˜ ê´€ë¦¬ì™€ ê´€ë ¨ëœ ì „í˜•ì ì¸ ì‚¬ë¡€ì…ë‹ˆë‹¤.</p>

          <div class="mb-xl">
            <h4 class="text-danger-600 mb-md">ğŸ” ë¬¸ì œì˜ ì›ì¸</h4>
            <p class="mb-md">ë¬¸ì œì˜ í•µì‹¬ì€ <strong class="text-danger-700">íŠ¸ëœì­ì…˜ ìŠ¤ëƒ…ìƒ·ì˜ ê°±ì‹ ì´ ì´ë£¨ì–´ì§€ì§€ ì•ŠëŠ” ê²ƒ</strong>ì…ë‹ˆë‹¤. êµ¬ì²´ì ì¸ ì›ì¸ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:</p>
            <ul class="text-secondary" style="padding-left: var(--space-lg);">
              <li class="mb-sm"><code>hikari.auto-commit: false</code> ì„¤ì •ìœ¼ë¡œ ì¸í•´ ìë™ ì»¤ë°‹ì´ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</li>
              <li class="mb-sm"><code>getMember()</code> ë©”ì„œë“œì— <code>@Transactional</code> ì–´ë…¸í…Œì´ì…˜ì´ ì—†ì–´ íŠ¸ëœì­ì…˜ ê²½ê³„(COMMIT/ROLLBACK)ê°€ ì—†ìŠµë‹ˆë‹¤.</li>
              <li class="mb-sm">MySQLì˜ ê¸°ë³¸ ê²©ë¦¬ ìˆ˜ì¤€ì¸ REPEATABLE READì—ì„œëŠ” íŠ¸ëœì­ì…˜ ì‹œì‘ ì‹œì ì˜ ìŠ¤ëƒ…ìƒ·ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
              <li class="mb-0">ë”°ë¼ì„œ, ì´ì „ ìŠ¤ëƒ…ìƒ·ì„ ì‚¬ìš©í•˜ëŠ” ì„¸ì…˜ì—ì„œëŠ” ìƒˆë¡œ ì¶”ê°€ëœ íšŒì› ë°ì´í„°ê°€ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
            </ul>
          </div>

          <div class="mb-xl">
            <h4 class="text-success-600 mb-md">âœ… í•´ê²°ì±… ì„¤ëª…</h4>
            <p class="mb-md">ê°€ì¥ ê°„ë‹¨í•˜ê³  íš¨ê³¼ì ì¸ í•´ê²°ì±…ì€ <strong class="text-success-700">getMember() ë©”ì„œë“œì— @Transactional(readOnly = true) ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€</strong>í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´:</p>
            <ul class="text-secondary" style="padding-left: var(--space-lg);">
              <li class="mb-sm">ë©”ì„œë“œê°€ íŠ¸ëœì­ì…˜ ë²”ìœ„ ë‚´ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.</li>
              <li class="mb-sm">ë©”ì„œë“œ ì¢…ë£Œ ì‹œ íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ë˜ì–´ ìŠ¤ëƒ…ìƒ·ì´ ê°±ì‹ ë©ë‹ˆë‹¤.</li>
              <li class="mb-0">readOnly=true ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ì˜ ìµœì í™”ëœ ì½ê¸° ì „ìš© íŠ¸ëœì­ì…˜ì„ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
            </ul>
          </div>

          <div class="mb-xl">
            <h4 class="text-warning-600 mb-md">âš ï¸ ë‹¤ë¥¸ í•´ê²°ì±…ë“¤ì˜ ë¬¸ì œì </h4>
            <ul class="text-secondary" style="padding-left: var(--space-lg);">
              <li class="mb-sm"><strong>ì—°ê²° í’€ í¬ê¸° ì¦ê°€</strong>: ì´ ë¬¸ì œëŠ” ì—°ê²° í’€ í¬ê¸°ì™€ ê´€ë ¨ì´ ì—†ìŠµë‹ˆë‹¤.</li>
              <li class="mb-sm"><strong>ëª¨ë“  ì½ê¸° ì‘ì—…ì„ Masterë¡œ ë¼ìš°íŒ…</strong>: ë¶€í•˜ ë¶„ì‚°ì˜ ì´ì ì„ ìƒê²Œ ë©ë‹ˆë‹¤.</li>
              <li class="mb-sm"><strong>open-in-view ì„¤ì • ë³€ê²½</strong>: ì´ ì„¤ì •ì€ ì§€ì—° ë¡œë”©ê³¼ ê´€ë ¨ëœ ë¬¸ì œë¥¼ í•´ê²°í•˜ì§€ë§Œ, ì´ ê²½ìš°ì˜ ìŠ¤ëƒ…ìƒ· ë¬¸ì œë¥¼ í•´ê²°í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
              <li class="mb-0"><strong>ê²©ë¦¬ ìˆ˜ì¤€ ë³€ê²½</strong>: ì‹œìŠ¤í…œ ì „ì²´ì˜ ê²©ë¦¬ ìˆ˜ì¤€ì„ ë³€ê²½í•˜ëŠ” ê²ƒì€ ë‹¤ë¥¸ ë¶€ì‘ìš©ì„ ì´ˆë˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
            </ul>
          </div>

          <div class="mb-xl">
            <h4 class="text-info-600 mb-md">ğŸ“– ë” ì•Œì•„ë³´ê¸°</h4>
            <p class="mb-md">ì´ ë¬¸ì œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê°œë…ë“¤ì„ ì´í•´í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤:</p>
            <ul class="text-secondary" style="padding-left: var(--space-lg);">
              <li class="mb-sm">ë°ì´í„°ë² ì´ìŠ¤ íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€</li>
              <li class="mb-sm">MVCC (ë‹¤ì¤‘ ë²„ì „ ë™ì‹œì„± ì œì–´)</li>
              <li class="mb-sm">ìŠ¤í”„ë§ì˜ íŠ¸ëœì­ì…˜ ê´€ë¦¬</li>
              <li class="mb-0">Master-Slave ì•„í‚¤í…ì²˜ì—ì„œì˜ ë°ì´í„° ì¼ê´€ì„±</li>
            </ul>
          </div>

          <div class="text-center">
            <button class="btn btn-primary btn-lg" onclick="nextCase()">
              ğŸš€ ë‹¤ìŒ ì‚¬ë¡€ë¡œ
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div th:replace="~{fragments/footer :: footer}"></div>

<script th:inline="javascript">
        let selectedDiagnosis = null;
        let selectedSolution = null;
        let score = 0;
        let totalScore = 0;

        function showClue(clueId) {
            const clueElement = document.getElementById(clueId);
            if (clueElement.classList.contains('hidden')) {
                clueElement.classList.remove('hidden');
                clueElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
                clueElement.classList.add('hidden');
            }
        }

        function selectDiagnosis(element, diagnosisId) {
            // ê¸°ì¡´ ì„ íƒ í•´ì œ
            const options = document.querySelectorAll('#diagnosis-section .diagnosis-option');
            options.forEach(option => option.classList.remove('selected'));

            // ìƒˆë¡œ ì„ íƒ
            element.classList.add('selected');
            selectedDiagnosis = diagnosisId;

            // ì œì¶œ ë²„íŠ¼ í™œì„±í™”
            document.getElementById('submit-btn').disabled = false;
        }

        function selectSolution(element, solutionId) {
            // ê¸°ì¡´ ì„ íƒ í•´ì œ
            const options = document.querySelectorAll('#solution .diagnosis-option');
            options.forEach(option => option.classList.remove('selected'));

            // ìƒˆë¡œ ì„ íƒ
            element.classList.add('selected');
            selectedSolution = solutionId;

            // ì œì¶œ ë²„íŠ¼ í™œì„±í™”
            document.getElementById('solution-btn').disabled = false;
        }

        function submitDiagnosis() {
            const feedbackElement = document.getElementById('feedback');

            // ì •ë‹µì€ 3ë²ˆ (íŠ¸ëœì­ì…˜ ìŠ¤ëƒ…ìƒ· ë¬¸ì œ)
            if (selectedDiagnosis === 3) {
                feedbackElement.innerHTML = `
                    <div style="display: flex; align-items: center; gap: var(--space-sm);">
                        <span style="font-size: 1.5rem;">ğŸ‰</span>
                        <p class="mb-0"><strong>ì •í™•í•©ë‹ˆë‹¤!</strong> ì´ ë¬¸ì œëŠ” íŠ¸ëœì­ì…˜ ìŠ¤ëƒ…ìƒ·ì´ ê°±ì‹ ë˜ì§€ ì•Šì•„ ë°œìƒí•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.</p>
                    </div>
                `;
                feedbackElement.classList.add('correct');
                feedbackElement.classList.remove('incorrect');
                score += 1;
            } else {
                feedbackElement.innerHTML = `
                    <div style="display: flex; align-items: center; gap: var(--space-sm);">
                        <span style="font-size: 1.5rem;">ğŸ¤”</span>
                        <p class="mb-0"><strong>ì•„ì‰½ê²Œë„</strong> ê·¸ê²ƒì€ ì£¼ëœ ì›ì¸ì´ ì•„ë‹™ë‹ˆë‹¤. ë‹¤ì‹œ í•œë²ˆ ë‹¨ì„œë“¤ì„ ê²€í† í•´ë³´ì„¸ìš”.</p>
                    </div>
                `;
                feedbackElement.classList.add('incorrect');
                feedbackElement.classList.remove('correct');
            }

            feedbackElement.classList.remove('hidden');
            document.getElementById('solution').classList.remove('hidden');
            totalScore += 1;
            updateScore();

            // í•´ê²°ì±… ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            document.getElementById('solution').scrollIntoView({ behavior: 'smooth', block: 'start' });

            // ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
            resetDiagnosisSelection();
        }

        function submitSolution() {
            const feedbackElement = document.getElementById('solution-feedback');

            // ì •ë‹µì€ 3ë²ˆ (getMember() ë©”ì„œë“œì— @Transactional(readOnly = true) ì¶”ê°€)
            if (selectedSolution === 3) {
                feedbackElement.innerHTML = `
                    <div style="display: flex; align-items: center; gap: var(--space-sm);">
                        <span style="font-size: 1.5rem;">ğŸ‰</span>
                        <p class="mb-0"><strong>ì™„ë²½í•©ë‹ˆë‹¤!</strong> getMember() ë©”ì„œë“œì— @Transactional(readOnly = true)ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì ì ˆí•œ í•´ê²°ì±…ì…ë‹ˆë‹¤.</p>
                    </div>
                `;
                feedbackElement.classList.add('correct');
                feedbackElement.classList.remove('incorrect');
                score += 1;
            } else {
                feedbackElement.innerHTML = `
                    <div style="display: flex; align-items: center; gap: var(--space-sm);">
                        <span style="font-size: 1.5rem;">ğŸ’­</span>
                        <p class="mb-0"><strong>ê·¸ í•´ê²°ì±…ì€</strong> ìµœì ì˜ ë°©ë²•ì´ ì•„ë‹™ë‹ˆë‹¤. ë‹¤ì‹œ í•œë²ˆ ë‹¨ì„œë“¤ì„ ê²€í† í•´ë³´ì„¸ìš”.</p>
                    </div>
                `;
                feedbackElement.classList.add('incorrect');
                feedbackElement.classList.remove('correct');
            }

            feedbackElement.classList.remove('hidden');
            document.getElementById('explanation').classList.remove('hidden');
            totalScore += 1;
            updateScore();

            // ì„¤ëª… ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            document.getElementById('explanation').scrollIntoView({ behavior: 'smooth', block: 'start' });

            // ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
            resetSolutionSelection();
        }

        function resetDiagnosisSelection() {
            selectedDiagnosis = null;
            const options = document.querySelectorAll('#diagnosis-section .diagnosis-option');
            options.forEach(option => option.classList.remove('selected'));
            document.getElementById('submit-btn').disabled = true;
        }

        function resetSolutionSelection() {
            selectedSolution = null;
            const options = document.querySelectorAll('#solution .diagnosis-option');
            options.forEach(option => option.classList.remove('selected'));
            document.getElementById('solution-btn').disabled = true;
        }

        function updateScore() {
            document.getElementById('score').innerText = score;
            document.getElementById('totalScore').innerText = totalScore;
            const progressBar = document.getElementById('progressBar');
            const progressPercentage = totalScore > 0 ? (score / totalScore) * 100 : 0;
            progressBar.style.width = progressPercentage + '%';
        }

        function nextCase() {
            // ë‹¤ìŒ ì‚¬ë¡€ë¡œ ì´ë™í•˜ëŠ” ë¡œì§
            alert("ì¶•í•˜í•©ë‹ˆë‹¤! ë‹¤ìŒ ì‚¬ë¡€ë¡œ ì´ë™í•©ë‹ˆë‹¤.");
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” location.href = '/bugs/2' ë“±ìœ¼ë¡œ ì²˜ë¦¬
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ì ìˆ˜ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function() {
            updateScore();
        });

        // ë‹¨ì„œ í‘œì‹œ ì‹œ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
        function showClueWithAnimation(clueId) {
            const clueElement = document.getElementById(clueId);
            if (clueElement.classList.contains('hidden')) {
                clueElement.classList.remove('hidden');
                clueElement.classList.add('fade-in');
                clueElement.scrollIntoView({ behavior: 'smooth', block: 'start' });

                // ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ ì œê±° (ì¬ì‚¬ìš©ì„ ìœ„í•´)
                setTimeout(() => {
                    clueElement.classList.remove('fade-in');
                }, 500);
            } else {
                clueElement.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
